# QQQ LEAPS Mastery Bot (v2.5)

这是一个针对 Interactive Brokers (IBKR) 的高级全自动交易系统，实施 **Core-Satellite (核心-卫星)** 策略，专注于 **QQQ LEAPS (长期期权)** 交易。

v2.5 版本引入了全新的 **硬核工业 (Hardcore Industrial)** 视觉设计、**全中文化控制面板**、**阶梯止盈管理系统** 以及 **工业级期权扫描器**。

## ✨ 核心特性 (v2.5 Features)

*   **🎨 硬核工业终端 (Hardcore Industrial)**: 深度定制的交易美学，高对比度霓虹配色，网格背板与胶片质感，专为专业交易员打造。
*   **🌏 深度中文化 (Deep Localization)**: 全流程中文化支持（登录、初始化、控制面板、系统报警），符合中文用户操作习惯。
*   **� 通信链路报警 (Comm Link Alerts)**: 黑色记录仪风格的监控面板，实时反馈策略心跳、扫描器状态、滑点警告及执行日志。
*   **🔍 工业级扫描器**: 
    *   **全链扫描**: 放弃硬编码锚点，实时全期权链检索。
    *   **Delta 精准过滤**: 支持可配置的 Delta 容错率 (Tolerance)。
    *   **流动性守卫**: 强制检测买卖价差 (Spread)，防止在流动性不足时被猎杀。
*   **�📊 Web 仪表盘**: 实时监控连接状态、持仓详情、账户资产（净值/现金/购买力）和策略配置。
*   **🔄 自动 ROLL 规则**: 满仓大跌时自动“卖旧换新”，下移执行价并重置到期时间。
*   **📈 利润循环 (Profit Recycling)**: 自动将期权已实现利润投向 QQQM 现货，实现不动用本金的自动化复利。
*   **⚙️ 动态配置系统**: 网页端实时调整 Target Delta, Entry Drop %, ROLL 阈值及阶梯止盈参数。
*   **🔒 安全架构**: 初始化管理员账号隔离，BCRYPT 密码哈希，JWT 会话管理。
*   **💾 SQLite 核心存储**: 工业化数据持久化，确保交易记录与系统配置的绝对可靠。

---

## 🎨 视觉系统 (Design System)

v2.5 采用了 **Hardcore Industrial Trading Terminal (硬核工业交易终端)** 美学设计。

### 设计理念
- **美学**: 极简工业风格 / 斯巴达式布局 / 战略监控终端
- **配色标准**:
  - **霓虹青 (#00f0ff)**: 核心链路与主交互
  - **矩阵绿 (#00ff41)**: 安全运营状态与现金流盈余
  - **电橙 (#ff6b00)**: 动态风险资产与警告提示
  - **深红 (#dc143c)**: 终止性错误与执行报警
  - **深空黑 (#050505)**: 减少视觉疲劳的背景基调

### 视觉特征
- **字体栈**: 
  - `Rajdhani`: 沉稳的工业标题
  - `JetBrains Mono`: 精确的等宽数据呈现
  - 支持 Microsoft YaHei / Noto Sans SC 等中文字体回退
- **动态交互**:
  - **Revealing**: 页面加载时的级联展开特效
  - **Grid & Grain**: 50px 战略网格背景与 8% 噪点质感
  - **Status Pulse**: 异步状态呼吸灯设计

---

## 🚀 部署指南 (Deployment)

### 1. Docker 部署 (推荐)

**先决条件**:
*   已运行 `ibkr-gateway` 容器 (Port 4004, Network `qqq_default`)。
*   确保 VPS 防火墙放行 **8000** 端口。

**启动步骤**:

1.  **准备数据卷**:
    ```bash
    docker volume create qqq-bot
    ```

2.  **拉取并运行**:
    ```bash
    docker-compose up -d
    ```

3.  **初始化系统**:
    *   访问: `http://<VPS_IP>:8000`
    *   按照 **[系统初始化进程]** 向导创建管理员识别码。
    *   登录后建立通信链路。

### 2. 查看系统日志

```bash
docker logs -f qqq-bot
```

---

## 🧠 策略逻辑 (Strategy Logic)

### 矛: 全域扫描扫描与入场 (Scanning & Entry)
*   **标的**: QQQ LEAPS (Expiry > 365 Days)。
*   **触发**: QQQ 较昨日收盘价下跌达到 `入场跌幅 %`。
*   **扫描器参数**:
    *   **目标 Delta**: (默认 0.6) 核心杠杆系数。
    *   **容错率**: (默认 0.05) 允许偏离目标 Delta 的范围。
    *   **流动性守卫**: (默认 3%) 当 Bid/Ask 价差超过此百分比时拒绝入场，保护本金。

### 盾: 阶梯止盈与退出 (Exit Protocol)
*   **动态阶梯止盈 (Stepped TP)**:
    *   系统会根据持仓天数动态匹配目标。
    *   例如：1-120 天目标 50%；121-180 天目标 30%。
*   **强制平仓 (Force Exit)**: 到达 `强制平仓天数` (默认 270 天) 后无视盈亏离场，对冲希腊值衰减风险。

### 🔄 滚动规则 (The Roll)
*   在大跌行情中（当日 `QQQ < -5%`），系统自动释放旧合约，换入同 Delta 、更低执行价、更新到期日的新合约，实现杠杆修复。

### 📈 利润循环 (Profit Recycling)
*   **会计准则**: `累计已实现利润 - 已投本金 = 利润池`。
*   **自动定投**: 当利润池 > 用户设定阈值时，自动购买 QQQM 现货。

---

## 📂 核心文件 (Structure)

*   **`main.py`**: 系统指挥中心，启动 IB 双向异步引擎。
*   **`strategy.py`**: 工业扫描器与交易逻辑核心。
*   **`persistence.py`**: SQLite 数据持久化与初始化种子。
*   **`web/server.py`**: FastAPI 高性能 Web 网关。
*   **`web/templates/`**: 硬核工业风格 Jinja2 模板。

---

## ⚠️ 免责声明 (Disclaimer)
本软件仅供教育和研究使用。自动化交易存在极高风险。在使用实盘资金前，务必在 Paper Trading (7497/4004) 中进行不少于 4 周的测试。使用风险由使用者自行承担。
